<!DOCTYPE html>
<html>
<head>
	<title id="title">Macros</title>
	<meta property="og:title" content="Macros" />
	<meta property="og:site_name" content="Doom 64 Compendium" />
	<meta property="og:description" content="Doom 64 Compendium documents the Doom 64 engine, its ports, and how to build content for them." />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://www.doom64.com/" />
	<meta property="og:image" content="https://www.doom64.com/d64c.png" />
	<meta property="og:image:width" content="1200" />
	<meta property="og:image:height" content="630" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<script src="../../scripts.js" type="text/JavaScript"></script>
	<link rel="stylesheet" href="../../style.css" />
	<link rel="icon" type="image/x-icon" href="../../favicon.svg" />
</head>
<body>
	<div id="navigation"></div>
	
	<div id="content">

		<h1>Macros</h1>
			<p>Macros are a unique scripting system used in Doom 64 which allow the you to script events to make the gameplay feel more dynamic and open ended. Macros are basically a series of line actions executed in batches, which provides the flexibility to move sectors separately, simultaneously, in the same or opposite directions, and to any height or depth. It also allows the you to modify walls, flags, textures and even how switches can be interacted with as well as spawning or removing actors. Only one macro can be executed at a time.</p>

			<p>BLAM is used to compile macros into a executable format for Doom 64. It is included with and automatically used by Doom Builder 64, so no separate download or setup is needed. The page icon on Doom Builder 64 will open the script editor where you can add macros. This script editor can also be found from the "View" menu. In the script editor, the page icon with the lightning bolt will compile the macro scripts.</p>

			<p>All available macro actions can be found on the page below, along with the types of values they take (height, thing tag, etc). It's recommended to have the list of actions open while scripting, for reference and to copy action names so as to avoid typos in your script.</p>
			
			<ul><li><a href="macrolist.html">Macro List</a></li></ul>
			
			<p>There is an undetermined maxmimum for the number of actions that one macro can be done on some engines; it is somewhere above 100. After this point macros tend to lose predictability. Decompiled macros from maps of the original Doom 64 campaign can be downloaded <a href="decompiled.zip">here</a>.</p>

		<h2>Getting Started</h2>

			<p>A macro script has three parts. The "includes" at the start, the "macros" themselves, and the "actions" within each macro.</p>

			<p>The following is a basic overview of a script:</p>

<pre>
includes

macro 1
{
	action;
	action;
}

macro 2
{
	action;
	action;
	action;
}
</pre>

			<p>The link below leads to a tutorial on how to build and debug macros. The following sections will describe macros more in depth which can help with the tutorial.</p>
			
			<ul><li><a href="macrotutorial.html">Macro Tutorial</a></li></ul>

		<h2>Structure of a Macro</h2>

			<p>A basic macro script in looks something like this:</p>
<pre>
// my first macro script

#setdir "c:\Doom Builder 64\Compilers\Doom64\"
#include "common.txt"

macro 1
{
	Door_Open(20);
	wait;
	Door_Open(40);
}
</pre>

			<p>The following items are explained below:</p>

			<tt>// my first macro script</tt>

			</p>This is a comment line. Comments don't affect the behavior of the script, they serve only as notes or short explanations of what the script does.</p>


			<tt>#setdir "c:\Doom Builder 64\Compilers\Doom64\"</tt>

			<p>This tells BLAM (the script compiler) "where" to look for files when using #include. #setdir 'must' be used before #include, otherwise #include will look in the folder where the wad itself is located. #setdir must also begin and end with quotes.</p>

			<tt>#include "common.txt"</tt>

			<p>The "#include" command instructs the compiler to open the given file and process it's contents before continuing on through the rest of the script. #include Must begin and end with quotes. In essense #setdir defines "where" to look for files, and #include tells "what" files to look for.</p>

			<p>The file "common.txt" is a standard file which contains all basic macro definitions, for use with Doom Builder 64's scripting system. It's required for Doom Builder 64 to know what macro commands are available. Always #include the file in your script.</p>

			<p>Common.txt can be found at: "('where you installed Doom Builder 64')\Compilers\Doom64\"</p>

			<p>Common.txt does not need to be distributed with your wad however, as it is just a list of commands for use with Doom Builder 64's script compiler (BLAM). For those who are curious common.txt contains human readable translations for the numerical macro scripting commands used by Doom 64. It would be possible to make macro scripts in Doom Builder 64 without common.txt, but would be quite painful as everything would just be different sets of numbers. Doom 64 itself does not use common.txt at all.</p>


			<tt>macro 1<br/>{</tt>

			<p>This is the beginning of a macro definition. This macro's identification number is 1. Script numbers can be 1-255, and is referenced by line types 256-511. You must have an open bracket "{" at the start of each macro, and must use a close bracket "}" to end each macro definition. Forgetting either bracket will result in errors.</p>

			<tt>Door_Open(20);</tt>

			<p>This is an action statement. "Door_Open" is the pre-defined name that executes the door open action. Inside the parenthesis "()" is where you put information needed for the action. In this case the "20" is the tag number for the sector(s) that should be treated as a door. Finally, a semicolon ";" ends the action. Note that "all actions 'must' end with a semicolon". Forgetting a semicolon will cause errors, and is also one of the most common causes of errors.</p>

			<p>Note that #include and #setdir are different from actions, and do not need semicolons.</p>

			<tt>wait;</tt>

			<p>This is a built-in statement that tells the script to wait until the most-recent action that was executed is finished. The rest of the macro will only continue running after that action completes.</p>

			<tt>Door_Open(40);</tt>

			<p>Any sector(s) with a tag of 40 will open like a door. In the example above, because of the 'wait;' statement before it, the door tagged 40 will not open until the door tagged 20 has opened completely. If the 'wait;' statement had not been there, both doors would open simultaneously. This means that without a 'wait;' command, actions within a macro will happen right after each other without delay.</p>

			<tt>}</tt>

			<p>And this closing bracket is the end of the macro definition. The macro is now complete.</p>

		<h2>Comments</h2>

			<p>Comments are parts of the macro script which are ignored by the script compiler (aka BLAM). They simply do nothing. Their purpose is to allow macro writers to insert notes, descriptions, or reminders into their scripts.</p>

			<p>BLAM supports 2 styles of comments:</p>
		
			<ul>

				<li>// line comment</li>
				<li>/* block comment */</li>
			</ul>

			<p>The first one, known as line comment, begins with a pair of slash signs (//) and ends at the end of the line. This means that the next line 'will not' be ignored when using a line comment. Unless that line contains a comment as well. The second one, known as block comment, starts at "/*" characters and ends at the first appearance of "*/" characters.</p>
	
<pre>
/* As you can see this is a block comment so it can continue through
   more than
   just one line */
   
#include "common.txt"
macro 1
{
	Door_Open(20);
	wait;
	Door_Open(40);
}
</pre>

			<p>When using a block comment 'always' make sure not to forget the "*/" at the end, or the entire rest of the script will get ignored.</p>

		<h2>Decompiling a Macro</h2>

			<p>It's possible to decompile already compiled macros from a map.</p>

			<p>The first step is to extract the MACROS lump from the map where <a href="http://slade.mancubus.net/">Slade</a> is recommended. The extracted MACROS.lmp will not be editable text, so it must be decompiled to make it a script which can be edited.</p>

			<p>Blam.exe is used to decompile a macros lump into editable text. Blam is found in the same folder as common.txt: "(install path)\Doom Builder 64\Compilers\Doom64". Now put MACROS.lmp into that folder. From here, there's a couple ways to make blam.exe decompile the lump.</p>

		<h3>Using a Batch file</h3>

			<p>Create a new text file (in the same folder as blam.exe and the macros.lmp) and open it. Copy this into the text file:</p>

<pre>cd /d %~dp0

START cmd /c "blam.exe macros.lmp macros.01.txt -d"</pre>

			<p>After saving, rename the text file to "decompile.bat". Running the batch file (it can be double clicked to run) should now decompile macros.lmp to the "macros.01.txt" file.</p>

		<h3>Creating a Shortcut</h3>

			<p>Create a shortcut to blam.exe (right click and choose "create shortcut"). Then right click the shortcut and choose "properties". In the properties window that comes up, select the "Shortcut" tab, if it isn't already. In the "Target:" field, go to the end (after where it says "...\blam.exe") and type " macros.lmp macros.txt -d" (minus the quotes). Then hit "Okay". Running the shortcut with "macros.lmp" in the folder should now decompile the script to the "macros.txt" file.</p>

	</div>

	<div id="footer"></div>
	<script>
	layout("../../");
	</script>
</body>
</html>
